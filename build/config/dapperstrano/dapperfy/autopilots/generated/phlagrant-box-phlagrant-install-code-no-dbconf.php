<?php

/*************************************
 *      Generated Autopilot file      *
 *     ---------------------------    *
 *Autopilot Generated By Dapperstrano *
 *     ---------------------------    *
 *************************************/

Namespace Core ;

class AutoPilotConfigured extends AutoPilot {

    public $steps ;

    public function __construct() {
        $this->setSteps();
    }

    private function setSteps() {

        $this->steps =
            array(
                array ( "Logging" => array( "log" => array( "log-message" => "Lets begin with ensuring the Project Container is initialized" ), ) ),
                array ( "Project" => array( "container" => array(
                    "proj-container" => "/var/www/workplace-systems/"
                ), ) , ) ,

                array ( "Logging" => array( "log" => array( "log-message" => "Lets initialize our new download directory as a dapper project"), ) ),
                array ( "Project" => array( "init" => array(), ) , ) ,

                array ( "Logging" => array( "log" => array( "log-message" => "Next create our host file entry for our local URL"), ) ),
                array ( "HostEditor" => array( "add" => array (
                    "guess" => true,
                    "host-name" => "www.workplace-systems.vm",
                ), ), ),

                array ( "Logging" => array( "log" => array( "log-message" => "Next create our virtual host"), ) ),
                array ( "ApacheVHostEditor" => array( "add" => array (
                    "guess" => true,
                    "vhe-docroot" => "/var/www/workplace-systems/",
                    "vhe-url" => "www.workplace-systems.vm",
                    "vhe-ip-port" => $this->getCurrentTargetFromPapyrusLocal(),
                    "vhe-vhost-dir" => "/etc/apache2/sites-available",
                    "vhe-template" => $this->getTemplate(),
                ), ), ),

                array ( "Logging" => array( "log" => array( "log-message" => "Now lets restart Apache so we are serving our new application version", ), ), ),
                array ( "ApacheControl" => array( "restart" => array(
                    "guess" => true,
                ), ), ),

                array ( "Logging" => array( "log" => array("log-message" => "Our deployment is done" ), ), ),
            );
    }

    private function getTemplate() {
        $template =
            <<<'TEMPLATE'
 NameVirtualHost 127.0.0.1:80
 NameVirtualHost 127.0.0.1:80 ****IP ADDRESS****:80
 <VirtualHost ****IP ADDRESS****:80>
   ServerAdmin webmaster@localhost
 	ServerName ****SERVER NAME****
 	DocumentRoot ****WEB ROOT****src
 	<Directory ****WEB ROOT****src>
 		Options Indexes FollowSymLinks MultiViews
 		AllowOverride All
 		Order allow,deny
 		allow from all
 	</Directory>
   ErrorLog /var/log/apache2/error.log
   CustomLog /var/log/apache2/access.log combined
 </VirtualHost>

TEMPLATE;

        return $template ;
    }

    protected function getCurrentTargetFromPapyrusLocal() {
        $plf = file_get_contents("/var/www/workplace-systems/papyrusfilelocal") ;
        $pfu = unserialize($plf) ;
        if (is_array($pfu) && count($pfu)>0) {
            return $pfu["phlagrant-box"]["target"] ; }
        return null ;
    }

}
